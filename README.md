# NotesApp

Приложение для управления заметками с использованием PostgreSQL, Kafka, Redis и Celery, запускаемое через Docker.

---

## Быстрый старт

### 1. Создайте файл `.env`

В корне проекта создайте файл `.env` на основе шаблона `.env.example` и заполните необходимые переменные:

```env
DB_USER="your_db_username"
DB_PASS="your_db_password"
DB_NAME="your_db_name"
ENV_MODE="docker"  # или "development"
```

- `ENV_MODE` — режим запуска приложения:
    - `"docker"` — запуск через Docker-контейнеры
    - `"development"` — локальная разработка на вашем компьютере

---

### 2. Запуск через Docker Compose

Для сборки и запуска всех сервисов выполните команду:

```bash
docker compose up --build
```

- Контейнеры PostgreSQL, Kafka, Redis, Celery и ваше приложение будут автоматически созданы и запущены.
- Переменные из `.env` автоматически подхватываются внутри контейнеров.

---

### 3. Локальная разработка

- Убедитесь, что у вас установлены все зависимости (рекомендуется использовать виртуальное окружение).
- Переменные окружения подгружаются из `.env`.
- Для работы в режиме разработки (`ENV_MODE="development"`) запустите локальные сервисы PostgreSQL, Kafka и Redis.
- Запустите также Celery, выполнив скрипт в отдельном терминале:

```bash
./run-celery.sh
```

- Запуск приложения:

```bash
python -m src.notes_app.__main__
```

Или, если у вас настроен `uvicorn`:

```bash
uvicorn src.notes_app.__main__:app --reload
```

(где `app` — экземпляр FastAPI в вашем проекте)

---

## Структура приложения

Структура проекта NotesApp организована по функциональным и инфраструктурным слоям, что обеспечивает удобство разработки и поддержки:

- **alembic/** — скрипты и конфигурация для миграций базы данных PostgreSQL с помощью Alembic.
- **docker-compose.yaml, dockerfile, docker-setting-up.sh** — файлы для настройки и запуска приложения в Docker-контейнерах.
- **run-celery.sh** — скрипт запуска Celery для фоновых задач.
- **src/notes_app/** — основной исходный код приложения, разбитый на несколько подсистем:
    - **api/** — реализация API, включая модели данных (`models`), провайдеры (`providers`) и маршруты (`routers`).
    - **application/** — бизнес-логика приложения, разделённая по модулям, например, работа с заметками (`note`) и пользователями (`user`).
    - **infrastructure/** — инфраструктурный код, включающий:
        - **config.py** — управление конфигурациями через Pydantic и dotenv.
        - **database/** — настройка подключения к базе, модели таблиц, репозитории и менеджмент транзакций.
        - **kafka_services/** — сервисы для работы с Kafka (продюсеры, консьюмеры, нотификаторы).
        - **redis_services/** — кеширование и взаимодействие с Redis.
        - **scheduler/** — интеграция с Celery, планирование и выполнение фоновых задач.
    - **__main__.py** — точка входа в приложение.
- **pyproject.toml, mypy.ini** — конфигурационные файлы для управления зависимостями и статической типизацией (mypy).
- **README.md** — документация проекта.

---

Такое разделение помогает изолировать ответственность компонентов, облегчает тестирование и масштабирование, а также поддерживает чистую архитектуру.

---

## Рекомендации

- При работе с Docker следите за тем, чтобы `.env` был доступен и корректно монтировался в контейнеры.
- Для отладки и разработки используйте режим `development`, для продакшена — `docker`.

---
